name: upload model to cos
on: 
  push:
    branches: [ model-upload-cos ]

jobs:
    sh:
        runs-on: ubuntu-latest
        env:
          secret_id: ${{secrets.qcloud_secret_id}}
          secret_key: ${{secrets.qcloud_secret_key}}
          region: ${{secrets.qcloud_region}}
        steps:
        - name: Free Disk Space (Ubuntu)
          uses: jerryliang122/free-disk-space@main
          with:
            # this might remove tools that are actually needed,
            # if set to "true" but frees about 6 GB
            tool-cache: true
            
            # all of these default to true, but feel free to set to
            # "false" if necessary for your workflow
            android: true
            dotnet: true
            haskell: true
            large-packages: true
            docker-images: true
            swap-storage: true 
            
        - name: Checkout
          uses: actions/checkout@v4

        - name: clone chatglm2-32k
          run: |
            git clone https://huggingface.co/THUDM/chatglm2-6b-32k
            cd chatglm2-6b-32k && rm -rf .git

        - name: download requirements.txt
          run: |
            pip install -r requirements.txt
        
        - name: zip chatglm2-32k
          run: |
            zip -r chatglm2-6b-32K.zip chatglm2-6b-32k

        - name: upload chatglm2-32k
          run: |
            python3 main.py